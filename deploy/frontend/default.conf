server {
  listen 80;
  server_name _;

  # Dashboard-only deployment: redirect root to /dashboard/
  location = / { return 302 /dashboard/; }

  # Dashboard SPA
  location ^~ /dashboard/ {
    alias /usr/share/nginx/html/dashboard/;

    # Avoid "stuck" UI after deploy: never cache the SPA entrypoint.
    # Hashed JS/CSS assets are safe to cache long-term.
    location = /dashboard/index.html {
      add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate" always;
      add_header Pragma "no-cache" always;
      add_header Expires "0" always;
      try_files $uri =404;
    }

    location ~* ^/dashboard/(?:assets|static)/.*\.(?:js|css|map|png|jpg|jpeg|gif|svg|ico|woff2?)$ {
      add_header Cache-Control "public, max-age=31536000, immutable" always;
      try_files $uri =404;
    }

    try_files $uri $uri/ /dashboard/index.html;
  }

  # Redirect root auth paths into /dashboard/* (keeps the dashboard under /dashboard)
  location = /login { return 301 /dashboard/login$is_args$args; }
  location = /register { return 301 /dashboard/register$is_args$args; }
  location = /forgot-password { return 301 /dashboard/forgot-password$is_args$args; }
  location = /reset-password { return 301 /dashboard/reset-password$is_args$args; }
  location = /admin/login { return 301 /dashboard/admin/login$is_args$args; }

  # Public invoice view is implemented in the dashboard SPA today
  location ^~ /public/invoices/ {
    alias /usr/share/nginx/html/dashboard/;
    try_files $uri $uri/ /dashboard/index.html;
  }

  # Public meeting booking pages are also implemented in the dashboard SPA
  location ^~ /public/meetings/ {
    alias /usr/share/nginx/html/dashboard/;
    try_files $uri $uri/ /dashboard/index.html;
  }

  # Everything else: redirect into the dashboard namespace
  location / { return 302 /dashboard/; }
}
