1ï¸âƒ£ What went wrong today (in simple words)

Issue:

The domain was opening with https://

But the server only had HTTP (port 80) configured

No SSL certificate existed yet

Result:

Browser â†’ tries HTTPS (443)

Server â†’ nothing listening there

Browser shows:
âŒ ERR_CONNECTION_REFUSED

Important lesson:

â— Ping working â‰  Website working
â— DNS correct â‰  HTTPS ready

2ï¸âƒ£ How we diagnosed it (this is the method)

We never guessed. We proved everything step by step.

Step A â€” Network
ping 165.227.187.206


âœ” Server reachable

Step B â€” Firewall
sudo ufw allow 80
sudo ufw allow 443
sudo ufw reload


âœ” Ports open

Step C â€” Is Nginx running?
sudo systemctl status nginx


âœ” Running

Step D â€” Is Nginx listening?
sudo ss -tulnp | grep nginx


âœ” Listening on :80

Step E â€” What is Nginx actually serving?
curl -I http://localhost
curl -I http://test.waraqaweb.com
curl -I http://165.227.187.206


âœ” All returned 200 OK
âœ” Same Next.js app

â¡ï¸ Conclusion:
The site worked on HTTP â†’ problem was HTTPS only.

3ï¸âƒ£ Emergency checklist (when a site doesnâ€™t load)

Whenever this happens again, follow this in order:

ğŸ”¹ 1. DNS
ping yourdomain.com

ğŸ”¹ 2. Server
ssh root@SERVER_IP

ğŸ”¹ 3. Nginx
sudo systemctl status nginx
sudo nginx -t

ğŸ”¹ 4. Ports
sudo ss -tulnp | grep -E '80|443'

ğŸ”¹ 5. Firewall
sudo ufw status

ğŸ”¹ 6. HTTP vs HTTPS

Try explicitly:

http://domain.com
https://domain.com


ğŸ‘‰ 90% of issues are found by step 6.

4ï¸âƒ£ Deployment flow (Computer â†’ GitHub â†’ DigitalOcean)

This is the clean workflow you should always use.

A) On your computer (local)
git status
git add .
git commit -m "Describe the change"
git push origin main


âœ” Code is now safely on GitHub

B) On DigitalOcean server
cd /opt/waraqa/app   # or your project folder
git pull origin main

If using Docker:
docker compose build
docker compose up -d

If NOT using Docker (Node.js):
npm install
npm run build
pm2 restart all

5ï¸âƒ£ Nginx setup (what goes where)
ğŸ“ Config location
/etc/nginx/sites-available/

Example: test.waraqaweb.com
server {
    listen 80;
    server_name test.waraqaweb.com;

    location / {
        proxy_pass http://localhost:3000; # or docker container
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
    }
}


Enable it:

ln -s /etc/nginx/sites-available/test.waraqaweb.com /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

6ï¸âƒ£ SSL / HTTPS (always do this)
Install Certbot
sudo apt update
sudo apt install certbot python3-certbot-nginx -y

Issue certificate
sudo certbot --nginx -d test.waraqaweb.com


Choose:
âœ” Redirect HTTP â†’ HTTPS

Auto-renew check
sudo systemctl status certbot.timer

7ï¸âƒ£ Database config (clean & correct)
Dashboard (MongoDB example)

.env file:

MONGO_URI=mongodb://127.0.0.1:27017/waraqa_dashboard
NODE_ENV=production

Website (separate DB recommended)
MONGO_URI=mongodb://127.0.0.1:27017/waraqa_website


ğŸ‘‰ Rule:
One database per app
Never mix dashboard + marketing data

8ï¸âƒ£ Golden rules (print these mentally)

Always test HTTP first

Never assume HTTPS exists

curl never lies â€” browsers do

Nginx running â‰  site configured

One app = one port = one config

If frustrated â†’ go back to checklist